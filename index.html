<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dynamic Editor</title>
<style>
body{margin:0;padding:0;display:flex;flex-direction:column;height:100vh;background:#0b0f19;color:#fff;font-family:'Segoe UI',sans-serif}
#toolbar{display:flex;gap:10px;padding:12px;background:#111827;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.6)}
button{padding:10px 18px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;transition:all .2s}
button:hover{transform:translateY(-2px);background:linear-gradient(135deg,#4f46e5,#7c3aed)}
#canvas{flex:1;margin:14px auto;width:95%;border-radius:14px;border:2px solid #1f2937;position:relative;background:#0f172a;overflow:hidden}
.grid-bg{position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(#1f2937 1px,transparent 1px),linear-gradient(90deg,#1f2937 1px,transparent 1px);background-size:var(--grid,20px) var(--grid,20px);pointer-events:none;z-index:0}
.element{position:absolute;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;font-weight:bold;cursor:pointer;z-index:1;box-shadow:0 4px 10px rgba(0,0,0,.4)}
.grid{background:#3b82f6}
.play_button{background:#ef4444}
.increase_button{background:#10b981}
.decrease_button{background:#f59e0b}
.win_label{background:#8b5cf6}
.handle{width:16px;height:16px;background:#fff;border:2px solid #000;border-radius:50%;position:absolute;bottom:-10px;right:-10px;cursor:se-resize;z-index:2}
.handle-label{position:absolute;bottom:-32px;right:0;background:#111827;color:#f9fafb;padding:4px 8px;border-radius:6px;font-size:11px;white-space:nowrap;box-shadow:0 2px 6px rgba(0,0,0,0.5);display:none}
.context-menu{position:absolute;background:#111827;border:1px solid #374151;border-radius:8px;padding:8px;display:none;flex-direction:column;gap:6px;z-index:10;box-shadow:0 4px 12px rgba(0,0,0,.6)}
.context-menu input{width:80px;padding:6px;border:1px solid #374151;border-radius:6px;background:#1f2937;color:#fff;font-size:13px}
.context-menu button{padding:6px 10px;font-size:13px;background:#2563eb;border:none;border-radius:6px;cursor:pointer}
#infoArea{padding:10px;background:#111827;border-top:2px solid #1f2937;display:flex;flex-direction:column;gap:8px}
textarea{width:100%;height:60px;padding:6px;font-size:14px;border:1px solid #374151;border-radius:8px;background:#1f2937;color:#fff;resize:none}
</style>
</head>
<body>
<div id="toolbar">
  <button id="addGrid">Insert Grid</button>
  <button id="addPlay">Insert Play</button>
  <button id="addIncrease">Insert +</button>
  <button id="addDecrease">Insert -</button>
  <button id="addWin">Insert Win</button>
</div>
<div id="canvas"><div class="grid-bg"></div></div>
<div id="infoArea">
  <textarea id="msgInput" placeholder="Type prompt..."></textarea>
  <button id="send">Send</button>
</div>
<div id="contextMenu" class="context-menu">
  <input id="xVal" placeholder="x">
  <input id="yVal" placeholder="y">
  <input id="wVal" placeholder="w">
  <input id="hVal" placeholder="h">
  <button id="applyVals">Apply</button>
</div>
<script>
const canvas=document.getElementById('canvas')
const contextMenu=document.getElementById('contextMenu')
const inputs={x:document.getElementById('xVal'),y:document.getElementById('yVal'),w:document.getElementById('wVal'),h:document.getElementById('hVal')}
let elements={grid:null,play_button:null,increase_button:null,decrease_button:null,win_label:null}
let currentEl=null
function createElement(type){
  if(elements[type])return
  const el=document.createElement('div')
  el.classList.add('element',type)
  el.style.width='120px'
  el.style.height='70px'
  el.style.left='50px'
  el.style.top='50px'
  const handle=document.createElement('div')
  handle.classList.add('handle')
  const label=document.createElement('div')
  label.classList.add('handle-label')
  el.appendChild(handle)
  el.appendChild(label)
  canvas.appendChild(el)
  elements[type]=el
  makeDraggable(el)
  makeResizable(el,handle,label)
  el.oncontextmenu=e=>{e.preventDefault();currentEl=el;showContextMenu(e.pageX,e.pageY)}
}
function makeDraggable(el){
  let startX,startY,origX,origY
  el.addEventListener('mousedown',e=>{
    if(e.target.classList.contains('handle'))return
    startX=e.clientX;startY=e.clientY
    const rect=el.getBoundingClientRect(),p=canvas.getBoundingClientRect()
    origX=rect.left-p.left;origY=rect.top-p.top
    function move(ev){
      let newX=Math.max(0,Math.min(origX+ev.clientX-startX,canvas.clientWidth-el.offsetWidth))
      let newY=Math.max(0,Math.min(origY+ev.clientY-startY,canvas.clientHeight-el.offsetHeight))
      el.style.left=newX+'px';el.style.top=newY+'px'
    }
    function up(){document.removeEventListener('mousemove',move);document.removeEventListener('mouseup',up)}
    document.addEventListener('mousemove',move)
    document.addEventListener('mouseup',up)
  })
}
function makeResizable(el,handle,label){
  let startX,startY,startW,startH
  handle.addEventListener('mouseover',()=>{updateLabel(el,label);label.style.display='block'})
  handle.addEventListener('mouseout',()=>{label.style.display='none'})
  handle.addEventListener('mousedown',e=>{
    e.stopPropagation()
    startX=e.clientX;startY=e.clientY
    startW=el.offsetWidth;startH=el.offsetHeight
    function move(ev){
      let newW=Math.max(30,startW+ev.clientX-startX)
      let newH=Math.max(30,startH+ev.clientY-startY)
      el.style.width=newW+'px';el.style.height=newH+'px'
      updateLabel(el,label)
    }
    function up(){document.removeEventListener('mousemove',move);document.removeEventListener('mouseup',up)}
    document.addEventListener('mousemove',move)
    document.addEventListener('mouseup',up)
  })
}
function updateLabel(el,label){
  const r=el.getBoundingClientRect(),p=canvas.getBoundingClientRect()
  label.textContent=`x=${r.left-p.left|0},y=${r.top-p.top|0},w=${r.width|0},h=${r.height|0}`
}
function showContextMenu(x,y){
  const r=currentEl.getBoundingClientRect(),p=canvas.getBoundingClientRect()
  inputs.x.value=r.left-p.left|0
  inputs.y.value=r.top-p.top|0
  inputs.w.value=r.width|0
  inputs.h.value=r.height|0
  contextMenu.style.display='flex'
  contextMenu.style.left=x+'px'
  contextMenu.style.top=y+'px'
}
document.addEventListener('click',e=>{if(!contextMenu.contains(e.target))contextMenu.style.display='none'})
document.getElementById('applyVals').onclick=()=>{
  if(!currentEl)return
  currentEl.style.left=inputs.x.value+'px'
  currentEl.style.top=inputs.y.value+'px'
  currentEl.style.width=inputs.w.value+'px'
  currentEl.style.height=inputs.h.value+'px'
  contextMenu.style.display='none'
}
document.getElementById('addGrid').onclick=()=>createElement('grid')
document.getElementById('addPlay').onclick=()=>createElement('play_button')
document.getElementById('addIncrease').onclick=()=>createElement('increase_button')
document.getElementById('addDecrease').onclick=()=>createElement('decrease_button')
document.getElementById('addWin').onclick=()=>createElement('win_label')
document.getElementById('send').onclick=()=>{
  const msg=document.getElementById('msgInput').value
  const data={message:msg}
  for(let k in elements){
    if(elements[k]){
      const r=elements[k].getBoundingClientRect(),p=canvas.getBoundingClientRect();
      data[k]={x:r.left-p.left|0,y:r.top-p.top|0,width:r.width|0,height:r.height|0}
    }
  }
  console.log(JSON.stringify(data))
}
</script>
</body>
</html>

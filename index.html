<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Game UI Editor Pro</title>
  <style>
    :root {
      --bg-dark: #020617;
      --bg-panel: #0f172a;
      --border: #1e293b;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --accent-primary: #38bdf8;
      --accent-secondary: #818cf8;
      --success: #10b981;
      --danger: #ef4444;
      --glass: rgba(15, 23, 42, 0.9);
    }

    * { box-sizing: border-box; outline: none; }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Inter, sans-serif;
      background-color: var(--bg-dark);
      background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 70%);
      color: var(--text-main);
      overflow: hidden;
    }

    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      gap: 10px;
    }

    /* --- HEADER --- */
    .header {
      width: 100%;
      /* Increased max-width to allow full screen usage */
      max-width: 100%; 
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 0 20px;
      position: relative;
      z-index: 500;
      flex-shrink: 0;
    }

    .toolbar {
      display: flex;
      gap: 10px;
      background: var(--glass);
      padding: 8px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: linear-gradient(180deg, #1e293b, #0f172a);
      color: #cbd5e1;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    .btn:hover { background: #334155; color: #fff; transform: translateY(-1px); }

    .btn.primary {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: #0f172a;
      border: none;
      box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
    }
    .btn.primary:hover { box-shadow: 0 0 20px rgba(56, 189, 248, 0.4); }

    /* --- DROPDOWN (Fixed Bridge) --- */
    .dropdown { position: relative; padding-bottom: 10px; margin-bottom: -10px; }
    
    .dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      margin-top: 5px;
      left: 0;
      flex-direction: column;
      background: #1e293b; 
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      overflow: visible; 
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      min-width: 220px;
    }

    .dropdown-content::before {
      content: "";
      position: absolute; top: -20px; left: 0; width: 100%; height: 20px; background: transparent;
    }

    .dropdown:hover .dropdown-content { display: flex; }
    
    .dropdown-content button {
      background: transparent; border: none; text-align: left; width: 100%;
      border-radius: 0; padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.05);
      color: #ffffff; font-weight: 500; font-size: 14px; position: relative; z-index: 1;
    }
    .dropdown-content button:first-child { border-top-left-radius: 8px; border-top-right-radius: 8px; }
    .dropdown-content button:last-child { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; border-bottom: none; }
    .dropdown-content button:hover { background: rgba(56, 189, 248, 0.15); color: #38bdf8; }

    /* --- LAYOUT WRAPPER --- */
    .canvasWrap {
      width: 100%;
      height: 100%;
      display: flex;
      gap: 15px; /* Reduced gap slightly */
      overflow: hidden;
      padding: 0 20px; /* Add padding on sides */
    }

    /* Scrollable Area for Canvas */
    .canvas-scroll-area {
      flex: 1; /* Takes all remaining space */
      overflow: auto;
      display: flex;
      justify-content: center; /* Centers canvas horizontally */
      align-items: flex-start;
      background: rgba(0,0,0,0.15); /* Slightly darker to distinguish area */
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* --- THE 1024x1024 STATIC CANVAS --- */
    .canvas {
      width: 1024px;
      height: 1024px;
      min-width: 1024px;
      min-height: 1024px;
      border-radius: 2px;
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(56, 189, 248, 0.3);
      box-shadow: 0 0 50px rgba(0,0,0,0.5);
      background-color: #0b1121;
      background-image: 
        linear-gradient(rgba(255, 255, 255, 0.07) 1px, transparent 1px), 
        linear-gradient(90deg, rgba(255, 255, 255, 0.07) 1px, transparent 1px);
      background-size: 64px 64px;
    }
    
    .canvas::after {
      content: ''; position: absolute; inset: 0; pointer-events: none;
      background: 
        linear-gradient(rgba(56, 189, 248, 0.15) 1px, transparent 1px),
        linear-gradient(90deg, rgba(56, 189, 248, 0.15) 1px, transparent 1px);
      background-size: 1024px 1024px; 
      background-position: -1px -1px;
    }

    /* --- RIGHT PANEL (EXPANDED) --- */
    .panel {
      /* FIXED: Increased width to 480px to fill the gap and allow better chat experience */
      width: 480px;
      min-width: 350px; /* Minimum width ensures it doesn't break on small screens */
      max-width: 30%; /* Limits it on ultra-wide screens */
      flex-shrink: 0; /* Prevents shrinking */
      
      background: var(--bg-panel);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: 100%; 
    }

    .panel-header {
      font-size: 14px; font-weight: 700; color: var(--text-muted);
      text-transform: uppercase; letter-spacing: 1px; padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      display: flex; justify-content: space-between; align-items: center;
    }

    /* Chat Container - Now takes advantage of the wider panel */
    .chat-container {
      background: #020617; border-radius: 8px; border: 1px solid rgba(255,255,255,0.05);
      padding: 15px; flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px;
    }

    .msg {
      max-width: 85%; padding: 12px 16px; border-radius: 12px; font-size: 14px;
      line-height: 1.5; position: relative; word-wrap: break-word;
    }
    .msg.user { align-self: flex-end; background: #1e293b; color: #e2e8f0; border: 1px solid #334155; border-bottom-right-radius: 2px; }
    .msg.bot { align-self: flex-start; background: rgba(56, 189, 248, 0.1); color: #e0f2fe; border: 1px solid rgba(56, 189, 248, 0.2); border-bottom-left-radius: 2px; }
    .msg.error { align-self: flex-start; background: rgba(239, 68, 68, 0.1); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.3); border-bottom-left-radius: 2px; font-weight: bold; }

    .textarea {
      width: 100%; height: 80px; padding: 12px; border-radius: 8px;
      border: 1px solid var(--border); background: #0b1121; color: var(--text-main); resize: none; font-size: 14px;
    }
    .textarea:focus { border-color: var(--accent-primary); }

    /* --- ELEMENTS --- */
    .element {
      position: absolute; border-radius: 4px; display: flex; align-items: center; justify-content: center;
      font-weight: 700; color: #fff; user-select: none; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      overflow: hidden; white-space: nowrap; border: 1px solid rgba(255,255,255,0.2);
      font-size: 14px; cursor: grab; backdrop-filter: blur(4px); z-index: 10;
    }
    .element:active { cursor: grabbing; border-color: #fff; z-index: 50; }

    .grid { background: linear-gradient(135deg, rgba(37,99,235,0.8), rgba(29, 78, 216, 0.9)); }
    .play_button { background: linear-gradient(135deg, #10b981, #059669); }
    .auto_play_button { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .increase_bet, .increase_level { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .decrease_bet, .decrease_level { background: linear-gradient(135deg, #f97316, #ea580c); }
    .max_bet_button { background: linear-gradient(135deg, #6366f1, #4f46e5); }
    .min_bet_button { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    .win_label { background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 8px; }
    .sprite { background: rgba(255,255,255,0.1); border: 1px dashed rgba(255,255,255,0.5); }
    .label { background: transparent; border: 1px dotted rgba(255,255,255,0.5); text-shadow: 0 2px 4px rgba(0,0,0,0.8); }

    .handle {
      position: absolute; right: 0; bottom: 0; width: 12px; height: 12px;
      background: #fff; cursor: se-resize; opacity: 0; clip-path: polygon(100% 0, 100% 100%, 0 100%);
    }
    .element:hover .handle { opacity: 1; }

    .badge {
      position: absolute; top: -22px; left: 0; background: #020617; color: var(--accent-primary);
      padding: 2px 6px; border-radius: 4px; font-size: 10px; border: 1px solid #334155;
      pointer-events: none; z-index: 100; white-space: nowrap;
    }

    .context {
      position: absolute; display: none; flex-direction: column; gap: 8px; padding: 12px;
      border-radius: 8px; background: #1e293b; border: 1px solid rgba(255,255,255,0.1);
      z-index: 2000; min-width: 200px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .context .row { display: flex; gap: 8px; align-items: center; }
    .context label { width: 30px; font-size: 11px; color: var(--text-muted); font-weight: bold; }
    .context input { flex: 1; background: #0f172a; border: 1px solid #334155; color: #fff; padding: 4px; border-radius: 4px; font-size: 12px; }
    .context button { flex: 1; padding: 6px; border-radius: 4px; border: none; cursor: pointer; font-size: 12px; font-weight: bold; }
    #btnDelete { background: #451a1a; color: #fca5a5; }
    #btnApply { background: var(--accent-primary); color: #000; }

    #progressContainer { height: 4px; background: #334155; border-radius: 2px; overflow: hidden; display: none; margin-top: 5px;}
    #progressFill { height: 100%; width: 0%; background: var(--success); transition: width 0.3s; }
    #links { display: none; flex-direction: column; gap: 6px; margin-top: 10px; }
    #links a {
      background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px;
      color: var(--accent-primary); text-decoration: none; text-align: center; font-size: 13px;
    }
    #links a:hover { background: rgba(255,255,255,0.1); }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <div class="toolbar">
        <button class="btn" id="addGrid">Add Grid</button>
        <div class="dropdown">
          <button class="btn">Add Component â–¾</button>
          <div class="dropdown-content">
            <button data-type="play_button">Play Button</button>
            <button data-type="increase_bet">Increase Bet (+)</button>
            <button data-type="decrease_bet">Decrease Bet (-)</button>
            <button data-type="auto_play_button">Auto Play</button>
            <button data-type="max_bet_button">Max Bet</button>
            <button data-type="min_bet_button">Min Bet</button>
            <button data-type="increase_level">Level Up</button>
            <button data-type="decrease_level">Level Down</button>            
          </div>
        </div>
        <button class="btn" id="addWin">Win Label</button>
        <button class="btn" id="addLabel">Text Label</button>
        <button class="btn" id="addSprite">Sprite Box</button>
      </div>
    </div>

    <div class="canvasWrap">
      <div class="canvas-scroll-area">
        <div id="canvas" class="canvas"></div>
      </div>
      
      <div class="panel">
        <div class="panel-header">
          <span>AI Assistant</span>
          <span style="font-size:10px; opacity:0.5">Online</span>
        </div>
        
        <div id="chatBox" class="chat-container">
           <div class="msg bot">System ready. Canvas fixed at 1024x1024.</div>
        </div>
        
        <textarea id="msgInput" class="textarea" placeholder="Describe game rules..."></textarea>
        
        <div id="waitMessage" style="display:none; color:var(--accent-secondary); font-size:11px; text-align:right;">Processing...</div>
        <div id="progressContainer"><div id="progressFill"></div></div>
        
        <div style="display:flex; justify-content:flex-end; margin-top:10px;">
          <button class="btn primary" id="send">Send</button>
        </div>

        <div id="links">
          <a id="playLink" href="#" target="_blank">â–¶ Play Game</a>
          <a id="downloadLink" href="#" target="_blank">â¬‡ Download Files</a>
          <a id="downloadAnalysis" href="#" target="_blank">ðŸ“Š View Analysis</a>
        </div>
      </div>
    </div>
  </div>

  <div id="contextMenu" class="context">
    <div class="row"><label>X</label><input id="ctxX" type="number"/></div>
    <div class="row"><label>Y</label><input id="ctxY" type="number"/></div>
    <div class="row"><label>W</label><input id="ctxW" type="number"/></div>
    <div class="row"><label>H</label><input id="ctxH" type="number"/></div>
    <div class="row" id="textRow"><label>TXT</label><input id="ctxText"/></div>
    <div class="row" style="margin-top:5px;">
      <button id="btnDelete">Delete</button>
      <button id="btnApply">Update</button>
    </div>
  </div>

<script>
const canvas = document.getElementById('canvas');
const contextMenu = document.getElementById('contextMenu');
const url = "https://hamster-teaching-serval.ngrok-free.app";
const session_id = "user_" + Math.floor(Math.random() * 1000000);
const sendButton = document.getElementById('send');

const ctxX = document.getElementById('ctxX'),
      ctxY = document.getElementById('ctxY'),
      ctxW = document.getElementById('ctxW'),
      ctxH = document.getElementById('ctxH'),
      ctxText = document.getElementById('ctxText'),
      textRow = document.getElementById('textRow');

const elements = {
  grid: null,
  play_button: null,
  increase_bet: null,
  decrease_bet: null,
  auto_play_button: null,
  max_bet_button: null,
  min_bet_button: null,
  increase_level: null,
  decrease_level: null,  
  win_label: null,
  labels: [],
  sprites: [] 
};  

let current = null;

function create(type) {
  if (type !== 'label' && type !== 'sprite' && elements[type]) return;

  const el = document.createElement('div');
  el.className = 'element ' + (type === 'label' ? 'label' : type);
  el.style.width = type==='grid'?'512px':'128px'; 
  el.style.height = type==='grid'?'512px':'64px';
  el.style.left = '64px';
  el.style.top = '64px';
  el.dataset.type = type;

  if (type === 'label' || type === 'sprite') {
    const span = document.createElement('span');
    span.textContent = type === 'label' ? 'New Label' : 'Sprite';
    el.appendChild(span);
  } else {
    el.textContent = type.replace(/_/g, ' ').toUpperCase();
    updateFontSize(el);
  }

  const handle = document.createElement('div');
  handle.className = 'handle';
  el.appendChild(handle);
  canvas.appendChild(el);

  if (type === 'label') elements.labels.push(el);
  else if (type === 'sprite') elements.sprites.push(el);
  else elements[type] = el;

  attach(el, handle);
}

function updateFontSize(el) {
  const w = el.offsetWidth, h = el.offsetHeight;
  if(el.dataset.type === 'grid') { el.style.fontSize = '32px'; return; }
  let size = Math.min(h * 0.4, w / (el.textContent.length||1) * 1.5);
  el.style.fontSize = Math.max(12, size) + "px";
  el.style.display="flex"; el.style.alignItems="center"; el.style.justifyContent="center";
}

function attach(el, handle) {
  el.addEventListener('mousedown', startDrag);
  handle.addEventListener('mousedown', startResize);
  el.addEventListener('mouseenter', ()=>showBadge(el));
  el.addEventListener('mouseleave', ()=>hideBadge(el));
  el.addEventListener('contextmenu', e => { e.preventDefault(); current=el; openContext(e.pageX, e.pageY); });
}

function getPos(el) {
  const r = el.getBoundingClientRect();
  const p = canvas.getBoundingClientRect();
  const scaleX = 1024 / p.width;
  const scaleY = 1024 / p.height;
  return { 
    x: Math.round((r.left - p.left) * scaleX), 
    y: Math.round((r.top - p.top) * scaleY), 
    width: Math.round(r.width * scaleX), 
    height: Math.round(r.height * scaleY) 
  };
}

function showBadge(el) {
  if(el._badge) return updateBadge(el);
  const b = document.createElement('div'); b.className='badge'; el._badge=b; el.appendChild(b); updateBadge(el);
}
function updateBadge(el){ const d=getPos(el); el._badge.textContent=`X:${d.x} Y:${d.y} [${d.width}x${d.height}]`; }
function hideBadge(el){ if(el._badge){el._badge.remove(); el._badge=null;} }

function startDrag(e) {
  if (e.target.classList.contains('handle')) return;
  const el = this; 
  const p = canvas.getBoundingClientRect();
  const scaleX = 1024 / p.width;
  const scaleY = 1024 / p.height;
  
  const startLeft = parseInt(el.style.left || 0);
  const startTop = parseInt(el.style.top || 0);
  const startX = e.clientX;
  const startY = e.clientY;

  el.style.zIndex = 100;

  function move(ev) {
    const deltaX = (ev.clientX - startX);
    const deltaY = (ev.clientY - startY);
    
    let nx = startLeft + (deltaX * scaleX);
    let ny = startTop + (deltaY * scaleY);
    
    nx = Math.max(0, Math.min(nx, 1024 - (el.offsetWidth * scaleX))); 
    ny = Math.max(0, Math.min(ny, 1024 - (el.offsetHeight * scaleY)));

    el.style.left = nx + 'px'; 
    el.style.top = ny + 'px';
    
    if(el._badge) updateBadge(el);
  }
  function up() { el.style.zIndex = ''; document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); }
  document.addEventListener('mousemove', move); document.addEventListener('mouseup', up);
}

function startResize(e) {
  e.stopPropagation(); e.preventDefault();
  const el = this.parentElement; el._resizing=true;
  const p = canvas.getBoundingClientRect();
  const scaleX = 1024 / p.width;
  const scaleY = 1024 / p.height;
  
  const startX = e.clientX;
  const startY = e.clientY;
  const startW = parseFloat(el.style.width);
  const startH = parseFloat(el.style.height);

  function move(ev) {
    const deltaX = (ev.clientX - startX) * scaleX;
    const deltaY = (ev.clientY - startY) * scaleY;
    
    const nw = Math.max(20, startW + deltaX);
    const nh = Math.max(20, startH + deltaY);
    
    el.style.width = nw + 'px'; el.style.height = nh + 'px';
    if(!['label','sprite'].includes(el.dataset.type)) updateFontSize(el);
    if(el._badge) updateBadge(el);
  }
  function up() { el._resizing=false; document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); }
  document.addEventListener('mousemove', move); document.addEventListener('mouseup', up);
}

function openContext(x, y) {
  const d = getPos(current);
  ctxX.value=d.x; ctxY.value=d.y; ctxW.value=d.width; ctxH.value=d.height;
  const isTxt = ['label','sprite'].includes(current.dataset.type);
  textRow.style.display = isTxt ? 'flex' : 'none';
  if(isTxt) ctxText.value = current.firstElementChild.textContent;
  
  let left = x, top = y;
  if(left+200 > window.innerWidth) left = window.innerWidth - 220;
  if(top+200 > window.innerHeight) top = window.innerHeight - 220;
  
  contextMenu.style.left = left+'px'; contextMenu.style.top = top+'px';
  contextMenu.style.display = 'flex';
}

document.getElementById('btnApply').addEventListener('click', () => {
  if(!current) return;
  const nx = Number(ctxX.value), ny = Number(ctxY.value), nw = Number(ctxW.value), nh = Number(ctxH.value);
  current.style.left = nx+'px'; current.style.top = ny+'px'; current.style.width = nw+'px'; current.style.height = nh+'px';
  if(['label','sprite'].includes(current.dataset.type)) current.firstElementChild.textContent = ctxText.value;
  else updateFontSize(current);
  contextMenu.style.display='none'; hideBadge(current);
});

document.getElementById('btnDelete').addEventListener('click', () => {
  if(!current) return;
  const t = current.dataset.type;
  current.remove();
  if(t==='label'){ const i=elements.labels.indexOf(current); if(i>-1) elements.labels.splice(i,1); }
  else if(t==='sprite'){ const i=elements.sprites.indexOf(current); if(i>-1) elements.sprites.splice(i,1); }
  else elements[t] = null;
  contextMenu.style.display='none';
});

document.addEventListener('click', e=>{ if(!contextMenu.contains(e.target)) contextMenu.style.display='none'; });
document.getElementById('addGrid').onclick = ()=>create('grid');
document.getElementById('addWin').onclick = ()=>create('win_label');
document.getElementById('addLabel').onclick = ()=>create('label');
document.getElementById('addSprite').onclick = ()=>create('sprite');
document.querySelectorAll('.dropdown-content button').forEach(b => b.onclick = ()=>create(b.dataset.type));

function collectPayload() {
  const payload = {};
  for (const k in elements) {
    if (k === 'labels' || k === 'sprites') continue;
    const el = elements[k];
    if (el) { payload[k] = getPos(el); }
  }
  payload.Labels = elements.labels.map(l => {
    const d = getPos(l);
    return { ...d, text: l.firstElementChild ? l.firstElementChild.textContent : '' };
  });
  payload.Sprites = elements.sprites.map(s => {
    const d = getPos(s);
    return { ...d, text: s.firstElementChild ? s.firstElementChild.textContent : '' };
  });
  payload.message = document.getElementById('msgInput').value;
  return payload;
}

sendButton.addEventListener('click', () => {
  const payload = collectPayload();
  const chatBox = document.getElementById("chatBox");
  
  const userMsg = document.createElement("div");
  userMsg.className = "msg user";
  userMsg.textContent = payload.message || "Generate Game Configuration";
  chatBox.appendChild(userMsg);
  
  document.getElementById("waitMessage").style.display="block";
  chatBox.scrollTop = chatBox.scrollHeight;

  fetch(`${url}/receive_message`, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ session_id, rects: payload })
  })
  .then(res => { if (!res.ok) throw new Error("Server error"); return res.json(); })
  .then(data => {
    document.getElementById("waitMessage").style.display="none";
    if (data.status === "True") {
      const botMsg = document.createElement("div");
      botMsg.className = "msg bot";
      botMsg.textContent = data.reply;
      chatBox.appendChild(botMsg);
      chatBox.scrollTop = chatBox.scrollHeight;
    } else {
      console.error("API Error:", data.reply);
    }
  })
  .catch(err => { 
    console.error("Fetch Error:", err); 
    document.getElementById("waitMessage").style.display="none";
    const botMsg = document.createElement("div");
    botMsg.className = "msg error";
    botMsg.textContent = "Server out, try again later..";
    chatBox.appendChild(botMsg);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
});

function checkStatus(){
  fetch(`${url}/get_status`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ session_id })
  })
  .then(res=>res.json())
  .then(data=>{
    const percent = data.process_percent||0;
    const progressContainer = document.getElementById("progressContainer");
    const progressFill = document.getElementById("progressFill");
    const links = document.getElementById("links");
    
    if(percent>0 && percent<100){
      progressContainer.style.display="block"; 
      links.style.display="none"; 
      progressFill.style.width=percent+"%";
      sendButton.disabled=true;
      sendButton.textContent = `Processing... ${percent}%`;
    } else if(percent===100){
      progressFill.style.width="100%"; 
      setTimeout(()=>{ progressContainer.style.display="none"; }, 1000);
      links.style.display="flex"; 
      document.getElementById("playLink").href = url + data.game_link;
      document.getElementById("downloadLink").href = url + data.download_link;
      document.getElementById("downloadAnalysis").href = url + data.analysis_link;
      sendButton.disabled=false;
      sendButton.textContent = "Send";
    } else {
      progressContainer.style.display="none";
    }
  })
  .catch(err=> { });
}
setInterval(checkStatus,1000);
</script>
</body>
</html>
